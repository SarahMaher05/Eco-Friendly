import React from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../../context/AuthContext.jsx'; 
// ๐จ ููุงุญุธุฉ: ูุฌุจ ุงูุชุฃูุฏ ูู ุตุญุฉ ุงููุณุงุฑ (../../context/AuthContext.jsx) ุจูุงุกู ุนูู ููุงู ุงููููู

/**
 * ูููู ูุญูุงูุฉ ุงููุณุงุฑุงุช. 
 * ูุนูุฏ ุชูุฌูู ุงููุณุชุฎุฏู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู ุฅุฐุง ูู ููู ูุณุฌูุงู.
 */
const ProtectedRoute = ({ children }) => {
    // ุฌูุจ ุญุงูุฉ ุงููุณุชุฎุฏู ุงูุญุงูู ูุญุงูุฉ ุงูุชุญููู ูู ุณูุงู ุงูุชูุซูู
    const { currentUser, isLoading } = useAuth();
    // ุฌูุจ ูููุน ุงููุณุชุฎุฏู ุงูุญุงูู ูุญูุธู ูู ุญุงูุฉ ุฅุนุงุฏุฉ ุงูุชูุฌูู
    const location = useLocation();

    // 1. ุนุฑุถ ุญุงูุฉ ุงูุชุญููู (ุงุฎุชูุงุฑู)
    // ุฅุฐุง ูุงู ุงููููู ูุง ูุฒุงู ูุชุญูู ูู ุญุงูุฉ ุงููุณุชุฎุฏู (ูุซู ุงูุชุธุงุฑ ุงุณุชุฌุงุจุฉ Firebase)ุ ูุง ุชุนุฑุถ ุดูุฆูุง.
    if (isLoading) {
        return null; // ุฃู ููููู ุนุฑุถ ูุคุดุฑ ุชุญููู ุฃููู
    }

    // 2. ุฅุฐุง ูู ููู ููุงู ูุณุชุฎุฏู ูุณุฌูุ ูู ุจุฅุนุงุฏุฉ ุงูุชูุฌูู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
    if (!currentUser) {
        // ูุญูุธ ุงููููุน ุงูุญุงูู ูู ุงูู state ({ from: location })
        // ุญุชู ูุชููู ูู ุฅุนุงุฏุฉ ุชูุฌูู ุงููุณุชุฎุฏู ุฅูู ูุฐู ุงูุตูุญุฉ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ.
        return <Navigate to="/login" state={{ from: location }} replace />;
    }

    // 3. ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุฌูุงูุ ุงุนุฑุถ ุงููููู ุงููุญูู (ุงูุฃุทูุงู)
    return children;
};

export default ProtectedRoute;